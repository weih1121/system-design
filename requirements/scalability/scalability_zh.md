# 系统设计中的可伸缩性和弹性

接下来要讨论的特性是**可伸缩性**。可伸缩性是指系统处理不断增长的负载的能力。负载可以定义为：

- 每秒请求数
- 传入或传出数据的量
- 并发连接数
- 或其他指标

我们可以**垂直**和**水平**地扩展系统：

- **垂直扩展（向上扩展）**：为单个机器添加更多资源（CPU、内存、存储）。
- **水平扩展（向外扩展）**：向系统添加更多的机器。

你可能还会听到**无共享架构（Shared-Nothing Architecture）**这个术语，用来描述可水平扩展的系统。

## 垂直扩展 vs. 水平扩展

可伸缩性很难实现，在设计系统时，我们应该提前考虑可伸缩性。

一方面，选择似乎很简单——我们应该倾向于水平扩展。随着负载的增加，我们可以不断向这样的系统添加机器，而垂直扩展是有限的。某种程度上，负载可能会超过可用的最大机器。高端机器通常非常昂贵；即使是第二或第三强大的机器可能也太昂贵。

另一方面，水平扩展也有自己的一系列挑战：

- **服务发现**：客户端需要发现服务机器。
- **请求路由**：我们需要解决请求路由问题，因为我们需要确保来自同一客户端的请求发送到同一台机器，这对于存储客户端状态的系统（暂时或永久）是常见的要求。
- **维护**：我们需要维护多台机器。

由于这些额外的复杂性，对于某些系统来说，先从单个机器开始，垂直扩展直到变得太昂贵，然后迁移到水平可扩展的解决方案是可以的。

### 示例：关系型数据库

关系型数据库就是一个很好的例子。我们通常从单个数据库实例开始，垂直扩展直到达到极限。可以通过**分片**来水平扩展写操作，通过**复制**来水平扩展读操作。稍后在课程中，我们将讨论所有细节。

**我的观点是，在系统设计中一切都有权衡。请不要认为我们现在只水平扩展系统。**

这在面试中尤其如此，候选人经常错误地认为高可伸缩性（通常意味着水平扩展）是当今每个系统的默认要求。事实并非如此。经验法则是与面试官交谈，以明确可伸缩性的需求。

## 可伸缩性 vs. 可用性

你可能会争辩，这是相当合理的，在单机解决方案中，主要关注的往往不是可伸缩性，而是可用性。唯一的机器总有一天会失败。因此，我们设计的任何系统都必须是分布式的，并且可以水平扩展。这使我们可以在系统中拥有多个冗余机器，从而提高可用性。

**说得很好。**但事实是，仅使用单台机器也可以实现高可用性——例如，使用**高可用性对（High-Availability Pair）**，也称为**主动-被动设置（Active-Passive Setup）**。在讨论负载均衡器时，我们会详细讨论这一点。

垂直和水平扩展可以结合使用。假设我们有一个可水平扩展的系统，我们希望保持机器数量较少，因为维护这样的系统更容易。随着负载的增加，我们用更强大的机器替换现有的机器。当进一步扩展变得太昂贵时，我们再回到水平扩展。

## 引入弹性

一个经常与可伸缩性一起出现的概念是**弹性**。弹性是指系统在需要时获取资源，在不再需要时释放资源的能力。

虽然这些术语看起来相似，但弹性和可伸缩性并不相同。

### 每日负载示例

这里有一个例子：

假设我们系统在一天中的请求分布如下——一个正态分布。请求数量在早上增加，达到峰值，然后下降。这是一个非常常见的流量模式，许多系统都有。

- 当请求率较低的夜间，我们需要**N 台机器**来处理负载。
- 当请求率较高的白天，我们需要**2N 台机器**来处理负载。

如果我们的系统是**弹性的**，我们可以在夜间从 N 台机器开始，随着白天负载的增加不断添加机器。峰值负载过去后，我们可以逐步减少机器的总数。

这就是弹性的含义：

- **在短时间间隔内增加或减少基础设施资源，以适应工作负载的变化。**
- **通过不超额配置资源来节省成本。**

一个非弹性的系统会要求我们始终拥有至少 2N 台机器。弹性有助于降低成本。

### 年度负载示例

现在让我们看看年度负载。我们的系统越来越受欢迎，负载随着时间增长。在一年的时间里，我们需要多次向上或向外扩展以适应增长。

这就是可伸缩性的含义：

- **在较长的时间间隔内以增量方式提供资源。**
- 可伸缩性是关于长期的、战略性的需求。

从这些考虑中也可以看出，**可伸缩性是实现弹性的前提**，对吗？如果系统不可伸缩，我们就无法快速提供和释放资源，这意味着我们无法使系统具有弹性。

## 手动 vs. 自动扩展

扩展可以**手动**或**自动**进行。自动扩展也称为**自动伸缩（Auto-Scaling）**，它是云计算的基石之一。在课程中，我们将详细讨论自动伸缩，甚至会讨论一个自动伸缩系统的高级设计。

谢谢。
