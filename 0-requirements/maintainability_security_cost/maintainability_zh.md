从产品发布到生命周期结束，我们需要维护产品，这涉及诸如识别和修复漏洞、添加新功能、提升性能、增加测试覆盖率、编写文档等多种活动。重视可维护性的公司在产品发布前需要回答一长串问题。我指的是我们之前提到的运营就绪评审过程。这些问题，或者更准确地说，是建议，汇集了实现运营卓越的最佳实践。目标是教育团队并识别系统中的运营差距。当所有主要问题得到解决后，我们就准备好发布产品了。主要且同时也是棘手的点在于，我们需要了解这些运营实践，并将它们纳入系统设计阶段。

好了，不再讨论抽象的东西。让我们进入一些具体内容。在面试中，我们应该预期会有关于可维护性以下几个方面的问题。

**1. 故障模式与缓解措施**

- 如果某个组件失败，系统的其他部分会发生什么？
- 系统如何处理网络分区？
- 我们希望系统如何处理网络分区？

**2. 监控**

- 我们如何监控系统的健康状态？
- 在系统故障时，如何准确知道具体哪个部分出现了问题？

**3. 测试**

- 如何测试每个独立组件？
- 如何进行端到端的数据流测试？

**4. 部署**

- 如何安全地部署定期更新？
- 如何快速回滚更改？

这绝不是一个完整的可维护性相关主题列表。但如果我们至少了解这四个方面，我们就可以与面试官进行有意义的讨论。一个价值百万美元的问题是如何学习所有这些主题。每一个主题本身就是一本书。没关系，我们将采取务实的方法。在本课程中，我们将构建一个分布式消息系统的参考架构。我们将采用这个参考架构，并展示如何将上述四个主题应用到实际系统中。对于每一个主题，我们将重点关注实践中常见的概念。

**安全性**是另一个非常广泛的领域。安全系统包含三个基本属性，通常称为CIA三元组。

- **保密性（Confidentiality）**：数据受到未经授权的查看者的保护。
- **完整性（Integrity）**：数据不会被篡改或丢失，只有授权查看者可以修改数据。
- **可用性（Availability）**：授权用户在需要时能够访问资源。

在实践中，这意味着我们的系统必须保护自己免受未经授权的访问和安全攻击。因此，常见的面试相关主题包括身份和权限管理，谁可以访问系统，谁可以访问系统中的什么，如何在系统中实现身份验证和授权。

**基础设施保护**：

- 系统是否受到DDoS攻击的保护？
- 是否受到其他常见攻击的保护，如信号注入或跨站脚本攻击？
- 是否应该使用Web应用防火墙或API网关来实现保护？

**数据保护**：

- 如何保护静态数据？
- 如何保护传输中的数据？

安全性的理论部分非常庞大，有许多关于这个主题的书籍。但在实践中，设计系统时，我们通常只使用一小部分关键概念和最佳实践。因此，我们将采用与维护相同的务实方法。我们将采用参考架构，并展示如何在分布式系统中实现关键安全机制。

列表中的最后一个非功能性需求是**成本优化**。在设计系统时，我们应该尽量估算其成本。从高层次来看，这个成本包括三部分：

1. **工程成本**：设计、实现、测试和部署系统所需的努力。
2. **维护成本**：未来维护系统所需的努力。
3. **资源成本**：硬件和软件费用。

我们是否应该在面试中被问及这三种成本中的任何一种？让我们来看一下。

要正确估算工程成本，我们需要对任务进行详细分解。这既耗时又需要对系统有深入理解。在系统设计面试中，我们既没有足够的时间，也没有对系统所有细节的深入理解。我们需要理解系统设计过程。因此，我们不应该期望在面试中被问及工程成本相关的问题。

至于维护成本，可能会有这样的提问。具体来说，关于如何降低维护成本的问题，这通常意味着自动化。自动化监控、测试、部署、配置管理、安全补丁等。我们将在讨论可维护性时单独涵盖这一主题。

至于资源成本，我们也应该预期会有相关的问题。面试官可能会要求我们优化资源成本，以了解我们将做出哪些权衡。让我们详细说明这一点。我们需要硬件和软件资源来运行系统。硬件资源包括所有物理机器、硬件负载均衡设备、网络设备等。面试官可能会要求我们进行容量估算，评估我们可能需要多少机器来处理数据，或者需要多少磁盘来存储数据。然后，我们将结果乘以单台机器的价格，得到大致的总硬件成本。

软件资源包括我们在系统中使用的所有商业软件。如今，大多数软件由公共云服务提供。实际上，提供软件的供应商并不重要。无论是公共云供应商还是公司旁边的服务团队，从成本估算的角度看，我们可以类似对待两者。无论是AWS提供的托管数据库服务，还是内部服务团队提供的服务，都没有太大区别。天下没有免费的午餐。我们需要在两种情况下都支付费用。在云供应商的情况下，这是我们支付的真实货币。在公司的专有解决方案中，通常是虚拟货币，即一个组织欠公司内另一个组织的钱。但这仍然是钱，且它会计入系统的总成本。因此，我们也应该将其计算在内。

使用托管服务时，有三个主要参数会影响成本：

1. 我们向服务发出的请求数量。
2. 我们传输的字节数，无论是入站还是出站。
3. 我们存储的字节数。

如果将所有这些因素综合在一起，我们可以写出以下公式：

资源总成本 = 硬件资源成本 + 我们发出的请求成本 + 传输字节成本 + 存储字节成本。

请注意，这不是一个精确的公式。如果你问我每小时支付的资源费用，比如云中的虚拟机或负载均衡器，我们将其包括在硬件成本中。我们还可以将不同许可证的成本纳入公式，但我不会这么做。我的目标是展示系统设计如何影响成本。尽管这个公式可能没有包括所有费用，但它非常适合我的目的。

让我们来看一些例子。当我们想要提高系统的可用性时，我们需要添加冗余硬件，硬件成本上升，资源总成本也上升。为了提高耐久性，我们需要复制数据，存储更多字节，存储成本上升。

同时，也有许多成本降低技术。例如，**弹性**允许我们在不再需要资源时释放它们，减少硬件成本。我们可以使用**长轮询**和**请求批处理**来减少向服务发出的请求数量。**数据压缩**有助于减少通过网络传输的字节数。为了降低存储成本，我们可以引入冷热存储。**热存储**代表需要快速访问的频繁使用数据，例如可以使用DynamoDB作为热存储。而**冷存储**不需要快速访问，主要代表归档和不常访问的数据，例如可以使用S3作为冷存储。冷存储通常更便宜。这只是一些例子。

与可维护性和安全性一样，我也将采用务实的方法。我们将采用参考架构，并展示在实际系统中进行成本优化的不同系统设计技术，包括如何进行容量估算的粗略计算。

如你所见，可维护性、安全性和成本优化都涉及知识，了解最佳实践和各种优化技巧。在面试中，当面对这些要求时，我们不需要重新发明轮子。我们需要提前学习这些内容，并在被问及时，从记忆中提取具体知识。
